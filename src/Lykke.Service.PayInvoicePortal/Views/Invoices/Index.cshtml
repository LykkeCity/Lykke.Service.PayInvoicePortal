@using Newtonsoft.Json
@using Newtonsoft.Json.Serialization

@model Lykke.Service.PayInvoicePortal.Models.Invoices.InvoiceModel
@{
    ViewData["Title"] = "Invoice - " + Model.Number;
}

<article class="content" data-ng-controller="invoiceDetailsCtrl as vm" data-ng-init="vm.handlers.init(@JsonConvert.SerializeObject(Model, new JsonSerializerSettings { ContractResolver = new DefaultContractResolver{NamingStrategy = new CamelCaseNamingStrategy()} }))">
    <section class="section section--padding">
        <div class="container">
            <div class="relative hidden-xs hidden-sm">
                <a href="/" onclick="history.back()" class="btn_back">
                    <img src="/img/back_icn.svg" width="30" height="12" alt="back">
                </a>
            </div>
            <div class="row">
                <div class="col-md-8 automargin">
                    <div class="invoice_page">
                        <div class="invoice_header">
                            <div class="row">
                                <div class="col-md-8">
                                    <h1 class="page__title">Invoice #{{vm.model.number}}</h1>
                                    <div class="invoice_header__link" data-ng-if="vm.model.allowPay">
                                        <a data-ng-href="{{vm.model.url}}" data-ng-bind="vm.model.url"></a>
                                        <button class="btn btn--icon _copy" type="button" data-copy="vm.model.url"><i class="icon icon--copy_thin"></i></button>
                                    </div>
                                </div>
                                <div class="col-md-4" data-ng-if="vm.model.allowPay">
                                    <div class="invoice_info__qr">
                                        <img data-ng-src="https://chart.googleapis.com/chart?chs=220x220&chld=L|2&cht=qr&chl={{vm.model.url}}" alt="qr" width="130" height="130">
                                    </div>
                                </div>
                            </div>

                            <div class="invoice_header__desc">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="invoice_header__data" data-ng-bind="vm.model.dueDate.format('LL')"></div>
                                    </div>
                                    <div class="col-md-4" data-ng-if="vm.handlers.canRemove()">
                                        <button class="btn btn--flat btn--default btn-sm pull-right" type="button" data-ng-click="vm.handlers.remove()"><i class="icon icon--delete"></i> Delete invoice</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="asset_link_list asset_link_list--thin">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Client</div>
                                            <div class="asset_link__desc" data-ng-bind="vm.model.client"></div>
                                        </div>
                                    </div>
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Email</div>
                                            <div class="asset_link__desc" data-ng-bind="vm.model.email"></div>
                                        </div>
                                    </div>
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Status</div>
                                            <div class="asset_link__desc" data-ng-bind="vm.model.status"></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Amount</div>
                                            <div class="asset_link__desc" data-ng-bind="vm.model.amount.toLocaleString(undefined, {minimumFractionDigits: 2})"></div>
                                        </div>
                                    </div>
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Currency</div>
                                            <div class="asset_link__desc"data-ng-bind="vm.model.currency"></div>
                                        </div>
                                    </div>
                                    <div class="asset_link">
                                        <div class="asset_link__info">
                                            <div class="asset_link__title">Pay due date</div>
                                            <div class="asset_link__desc" data-ng-bind="vm.model.dueDate.format('LL')"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form_header" data-ng-if="vm.model.files && vm.model.files.length > 0">
                            <h3>Files</h3>
                        </div>

                        <div class="attachment_list" data-ng-if="vm.model.files && vm.model.files.length > 0">
                            <div class="asset_link_list">
                              <div class="asset_link asset_link--alt" data-ng-repeat="file in vm.model.files">
                                <div class="asset_link__icon">
                                  <div class="asset_icon asset_icon--red" data-ng-bind="vm.handlers.getFileExtension(file.name)"></div>
                                </div>
                                <div class="asset_link__action">
                                  <button class="btn btn--icon _delete_asset" data-ng-click="vm.handlers.getFile(file)"><i class="icon icon--download"></i></button>
                                </div>
                                <div class="asset_link__info">
                                  <div class="asset_link__title" data-ng-bind="file.name"></div>
                                  <div class="asset_link__desc" data-ng-bind="vm.handlers.getFileSize(file.size)"></div>
                                </div>
                              </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</article>