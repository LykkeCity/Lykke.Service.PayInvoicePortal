function updateBalance(){$.ajax({url:"/home/Balance",dataType:"json",type:"POST",success:function(n){$(".balance__quantity").text(n)}})}function validate(n){for(var r=0,u=n?"none":"",i=$("#createform input").filter("[require]:visible"),t=0;t<i.length;t++)n&&$(i[t]).val(""),$(i[t]).removeClass("error"),$(i[t]).val()==""&&($(i[t]).addClass("error"),n||r++);return r}function editItem(n){for(var i,t,r,e,f=null,u=0;u<invoices.length;u++)if(invoices[u].InvoiceId==n){f=invoices[u];break}for(i=Object.keys(f),t=0;t<i.length;t++)r=f[i[t]],r||(r=""),e=document.getElementById(i[t]),(i[t]==="createdDate"||i[t]==="dueDate")&&(r=r.substr(0,10)),e&&(e.value=r)}function updateGrid(n){for(var i={Filter:filter,Page:pagenumber},t=0;t<statuses.length;t++)filter.status=statuses[t],$.ajax({url:"/home/Invoices",dataType:"json",type:"POST",data:i,success:function(t){t.filter.status==="All"&&renderGridHeader(t);renderStatus(t,n);updatedStatusCnt++;updatedStatusCnt===statuses.length&&setEvents()}})}function setEvents(){$(".btn.btn--icon.delete").on("click",function(n){n.stopPropagation();var t=$(n.target.parentNode.parentNode.parentNode).attr("invoice");$.confirm({title:"Are you sure?",content:"Do you really want to delete this invoice?",icon:"fa fa-question-circle",animation:"scale",closeAnimation:"scale",opacity:.5,buttons:{confirm:{text:"Yes",btnClass:"btn-blue",action:function(){$.ajax({url:"/home/deleteinvoice?invoiceId="+t,dataType:"html",success:function(){updateGrid()}})}},cancel:function(){}}})});updatedStatusCnt=0}function renderGridHeader(n){var t=document.getElementById("alllink"),i=document.getElementById("paidlink"),r=document.getElementById("unpaidlink"),u=document.getElementById("draftlink"),f=document.getElementById("removedlink"),e=document.getElementById("latepaidlink"),o=document.getElementById("overpaidlink"),s=document.getElementById("inprogresslink"),h=document.getElementById("underpaidlink");t.childNodes[1].innerText=n.header.allCount;u.childNodes[1].innerText=n.header.draftCount;i.childNodes[1].innerText=n.header.paidCount;r.childNodes[1].innerText=n.header.unpaidCount;f.childNodes[1].innerText=n.header.removedCount;s.childNodes[1].innerText=n.header.inProgressCount;h.childNodes[1].innerText=n.header.underpaidCount;e.childNodes[1].innerText=n.header.latePaidCount;o.childNodes[1].innerText=n.header.overpaidCount}function renderStatus(n,t){var f=null,s,o,i,e,r,u,l;n.filter.status===null&&(n.filter.status="all");var c="",a=document.getElementById("rowtemplate").innerHTML,h=document.getElementById(n.filter.status.toLowerCase());for(h.getElementsByClassName("invoices__table").length!==1?(f=document.createElement("div"),f.className="invoices__table",h.appendChild(f),h.childNodes[0].appendChild(f)):f=h.getElementsByClassName("invoices__table")[0],s=n.data,o=0;o<s.length;o++){for(i=a,e=Object.keys(s[o]),r=0;r<e.length;r++)u=s[o][e[r]],u==null&&(u=""),e[r]=="status"&&u==""&&(u="Draft"),(e[r]==="createdDate"||e[r]==="dueDate")&&(u=u.substr(0,10)),i=i.replace(new RegExp("{{"+e[r]+"}}","g"),u);switch(s[o].status){case"Paid":i=i.replace("{{cssClass}}","green");break;case"Unpaid":i=i.replace("{{cssClass}}","yellow");i=i.replace("{{disCssClass}}","");i=i.replace("{{disoption}}","");break;case"Draft":i=i.replace("{{disoption}}","");i=i.replace("{{disCssClass}}","");i=i.replace("{{cssClass}}","gray");break;case"Removed":i=i.replace("{{cssClass}}","");break;case"UnderPaid":case"OverPaid":i=i.replace("{{cssClass}}","violet")}i=i.replace("{{cssClass}}","red");i=i.replace("{{disCssClass}}","btn--disabled");i=i.replace("{{disoption}}","disabled");c+=i}t?f.innerHTML+=c:f.innerHTML=c;$(".invoices_item").on("click",function(n){var t,i;if(n.stopPropagation(),t=n.target,t.className!=="invoices_item")while(t.className!=="invoices_item")t=t.parentNode;i=$(t).attr("invoice");window.location.href="/home/invoicedetail/?InvoiceId="+i});l=document.getElementsByClassName("showmore "+n.filter.status)[0];l.style.display=n.pageCount!==0&&n.pageCount>pagenumber?"":"none"}function showItem(n){for(var r,f,e,u=n,i=Object.keys(u),t=0;t<i.length;t++)r=u[i[t]],r||(r=""),f=document.getElementById("Unpaid"+i[t]),i[t]==="Amount"&&(r=u[i[t]]),(i[t]==="CreatedDate"||i[t]==="DueDate")&&(r=r.substr(0,10)),f&&(f.innerText=r),i[t]=="Id"&&(e=document.getElementById("UnpaidUrl"),e.innerText=window.location.origin+"/invoice/"+r)}function setTooltip(n){$(".create__item-copy").attr("title",n);$(".create__item-copy").tooltip("open")}function setActiveTab(){var n="#all";n=window.location.href.indexOf("#")!==-1?window.location.href.substr(window.location.href.indexOf("#")):getCookie("currenttab");n&&($('li[role="presentation"]').removeClass("active"),$('li[role="presentation"] a[href="'+n+'"]').tab("show"),window.location.href=n)}function getCookie(n){var t=document.cookie.match(new RegExp("(?:^|; )"+n.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):undefined}function disableButtons(){$("#generatebtn").attr("disabled","disabled");$("#draftbtn").attr("disabled","disabled")}function enableButtons(){$("#generatebtn").removeAttr("disabled");$("#draftbtn").removeAttr("disabled")}function getFileSize(n){return n<1024?n+" bytes":n>1024&&n<1048576?(n/1024).toFixed(0)+" KB":(n/1048576).toFixed(0)+" MB"}function showSearch(n){n.preventDefault();searchBlock.toggleClass(searchActiveClass)}function hideSearch(n){n.preventDefault();searchBlock.removeClass(searchActiveClass)}var pagenumber=1,filter={},updatedStatusCnt,statuses,searchBlock,searchActiveClass;filter.sortField="";filter.searchValue="";filter.sortWay=0;filter.period=0;updatedStatusCnt=0;statuses=["All","Paid","Unpaid","Draft","Removed","InProgress","Overpaid","Underpaid","LatePaid"];$(document).ready(function(){updateGrid();updateBalance();setActiveTab();generateditem&&generateditem.Status!=="Draft"&&(showItem(generateditem),$("body").addClass("body--menu_opened"),$(".create.unpaid").addClass("sidebar_menu--open"),generateditem=null);$("#generatebtn").on("click",function(){$("#Status").val("Unpaid");$("#Currency").val()==""&&$("#Currency").val("CHF");updateGrid()});$('a[data-toggle="tab"]').on("click",function(n){var t=n.currentTarget.getAttribute("href");t&&(document.cookie="currenttab="+t,window.location=t)});$("#upload").change(function(){var r,t,n,i;for($(".new_file").remove(),r=/(\.pdf|\.doc|\.docx|\.xls|\.xlsx)$/i,t=0;t<this.files.length;t++)if(!r.exec(this.files[t].name))return alert("The file '"+this.files[t].name+"' is invalid, allowed extensions are: .pdf; .doc; .docx; .xls; .xlsx."),this.value="",!1;for(n=0;n<this.files.length;n++)$(".invoice_files_hint").hide(),i=$(".invoice_files"),i.show(),$(".asset_icon",i).text(this.files[n].name.split(".").pop()),$(".asset_link__title",i).text(this.files[n].name),$(".asset_link__desc",i).text(getFileSize(this.files[n].size));return!0});$(".icon.icon--copy_thin").on("click",function(n){n.stopPropagation();var t=$("<input>");$("body").append(t);t.val($("#UnpaidUrl").text()).select();document.execCommand("copy");t.remove();setTooltip("Copied!")});$("#draftbtn").on("click",function(){$("#Amount").attr("min","0.00");$("#Status").val("Draft");$("#Currency").val()==""&&$("#Currency").val("CHF");updateGrid()});$("#closebtn").on("click",function(){$("body").removeClass("body--menu_opened");$(".create").removeClass("sidebar_menu--open")});$("#closeunpaidbtn").on("click",function(){$("body").removeClass("body--menu_opened");$(".create").removeClass("sidebar_menu--open")});$(".invoices__search").on("click",function(){$(".profile_search").toggleClass("vis")});$(".invoices__row .invoices__cell").on("click",function(n){var t=n.target;filter.sortField="";pagenumber=1;filter.sortWay=filter.sortWay==0?1:0;t.className.indexOf("number")!==-1&&(filter.sortField="number");t.className.indexOf("client")!==-1&&(filter.sortField="client");t.className.indexOf("amount")!==-1&&(filter.sortField="amount");t.className.indexOf("currency")!==-1&&(filter.sortField="currency");t.className.indexOf("status")!==-1&&(filter.sortField="status");t.className.indexOf("date")!==-1&&(filter.sortField="duedate");filter.sortField!==""&&updateGrid()});$(".profile_search__button").on("click",function(){$(".profile_search").removeClass("vis");$("#searchvalue").val("");filter.searchValue="";filter.period=0;updateGrid()});$(".profile_search__button_close").on("click",function(){$("#searchvalue").val("");filter.searchValue="";filter.period=0;updateGrid()});$("#searchvalue").on("input",function(){filter.searchValue=$("#searchvalue").val();updateGrid()});$("#createform").submit(function(){var n=validate();return $("#Status").val()==="Draft"&&$("#ClientName").val()!==""?!0:n===0?($("#createform").submit(function(){return!1}),disableButtons(),!0):(enableButtons(),!1)});$(".create__item-copy").tooltip({show:{effect:"slideDown",delay:250}});$("body").on("click",function(n){n.target.className==="menu_overlay"?($("body").removeClass("body--menu_opened"),$(".create.draft").removeClass("sidebar_menu--open"),$(".create.unpaid").removeClass("sidebar_menu--open")):(n.target.className==="ui-icon ui-icon-circle-triangle-w"||n.target.className==="ui-icon ui-icon-circle-triangle-e"||n.target.className==="ui-datepicker-prev ui-corner-all ui-state-hover ui-datepicker-prev-hover"||n.target.className==="ui-datepicker-next ui-corner-all ui-state-hover ui-datepicker-next-hover")&&$("body").addClass("body--menu_opened")});$(".create.draft").on("click",function(n){n.stopPropagation()});$(".create.unpaid").on("click",function(n){n.stopPropagation()});$("#selectperiod").on("change",function(){$("._value").text($("#selectperiod option:selected").text());filter.period=$("#selectperiod option:selected").val();updateGrid()});$(".showmore").on("click",function(){pagenumber++;updateGrid(!0)})});searchBlock=$(".search_filter");searchActiveClass="search_filter--show";$("._show_search_block").on("click",showSearch);$("._hide_search_block").on("click",hideSearch);